.TH CLEANUP 8 
.ad
.fi
.SH NAME
cleanup
\-
canonicalize and enqueue Postfix message
.SH SYNOPSIS
.na
.nf
\fBcleanup\fR [generic Postfix daemon options]
.SH DESCRIPTION
.ad
.fi
The \fBcleanup\fR daemon processes inbound mail, inserts it
into the \fBincoming\fR mail queue, and informs the queue
manager of its arrival.

The \fBcleanup\fR daemon always performs the following transformations:
.IP \(bu
Insert missing message headers: (\fBResent-\fR) \fBFrom:\fR,
\fBTo:\fR, \fBMessage-Id:\fR, and \fBDate:\fR.
.IP \(bu
Extract envelope recipient addresses from (\fBResent-\fR) \fBTo:\fR,
\fBCc:\fR and \fBBcc:\fR message headers when no recipients are
specified in the message envelope.
.IP \(bu
Transform envelope and header addresses to the standard
\fIuser@fully-qualified-domain\fR form that is expected by other
Postfix programs.
This task is delegated to the \fBtrivial-rewrite\fR(8) daemon.
.IP \(bu
Eliminate duplicate envelope recipient addresses.
.PP
The following address transformations are optional:
.IP \(bu
Optionally, rewrite all envelope and header addresses according
to the mappings specified in the \fBcanonical\fR(5) lookup tables.
.IP \(bu
Optionally, masquerade envelope sender addresses and message
header addresses (i.e. strip host or domain information below
all domains listed in the \fBmasquerade_domains\fR parameter,
except for user names listed in \fBmasquerade_exceptions\fR).
By default, address masquerading does not affect envelope recipients.
.IP \(bu
Optionally, expand envelope recipients according to information
found in the \fBvirtual\fR(5) lookup tables.
.PP
The \fBcleanup\fR daemon performs sanity checks on the content of
each message. When it finds a problem, by default it returns a
diagnostic status to the client, and leaves it up to the client
to deal with the problem. Alternatively, the client can request
the \fBcleanup\fR daemon to bounce the message back to the sender
in case of trouble.
.SH STANDARDS
.na
.nf
RFC 822 (ARPA Internet Text Messages)
RFC 2045 (MIME: Format of Internet Message Bodies)
RFC 2046 (MIME: Media Types)
.SH DIAGNOSTICS
.ad
.fi
Problems and transactions are logged to \fBsyslogd\fR(8).
.SH BUGS
.ad
.fi
Table-driven rewriting rules make it hard to express \fBif then
else\fR and other logical relationships.
.SH CONFIGURATION PARAMETERS
.na
.nf
.ad
.fi
The following \fBmain.cf\fR parameters are especially relevant to
this program. See the Postfix \fBmain.cf\fR file for syntax details
and for default values. Use the \fBpostfix reload\fR command after
a configuration change.
.SH Content filtering
.IP \fBbody_checks\fR
Lookup tables with content filters for message body lines.
These filters see physical lines one at a time, in chunks of
at most line_length_limit bytes.
.IP \fBbody_checks_size_limit\fP
The amount of content per message body segment that is
subjected to \fB$body_checks\fR filtering.
.IP \fBheader_checks\fR
.IP "\fBmime_header_checks\fR (default: \fB$header_checks\fR)"
.IP "\fBnested_header_checks\fR (default: \fB$header_checks\fR)"
Lookup tables with content filters for message header lines:
respectively, these are applied to the primary message headers
(not including MIME headers), to the MIME headers anywhere in
the message, and to the initial headers of attached messages.
These filters see logical headers one at a time, including headers
that span multiple lines.
.SH MIME Processing
.ad
.fi
.IP \fBdisable_mime_input_processing\fR
While receiving, give no special treatment to \fBContent-Type:\fR
message headers; all text after the initial message headers is
considered to be part of the message body.
.IP \fBmime_boundary_length_limit\fR
The amount of space that will be allocated for MIME multipart
boundary strings. The MIME processor is unable to distinguish
between boundary strings that do not differ in the first
\fB$mime_boundary_length_limit\fR characters.
.IP \fBmime_nesting_limit\fR
The maximal nesting level of multipart mail that the MIME
processor can handle. Refuse mail that is nested deeper.
.IP \fBstrict_8bitmime\fR
Turn on both \fBstrict_7bit_headers\fR and \fBstrict_8bitmime_body\fR.
.IP \fBstrict_7bit_headers\fR
Reject mail with 8-bit text in message headers. This blocks
mail from poorly written applications.
.IP \fBstrict_8bitmime_body\fR
Reject mail with 8-bit text in content that claims to be 7-bit,
or in content that has no explicit content encoding information.
This blocks mail from poorly written mail software. Unfortunately,
this also breaks majordomo approval requests when the included
request contains valid 8-bit MIME mail, and it breaks bounces from
mailers that do not properly encapsulate 8-bit content (for example,
bounces from qmail or from old versions of Postfix).
.IP \fBstrict_mime_encoding_domain\fR
Reject mail with invalid \fBContent-Transfer-Encoding:\fR
information for message/* or multipart/*. This blocks mail
from poorly written software.
.SH Miscellaneous
.ad
.fi
.IP \fBalways_bcc\fR
Address to send a copy of each message that enters the system.
.IP \fBhopcount_limit\fR
Limit the number of \fBReceived:\fR message headers.
.IP \fBundisclosed_recipients_header\fR
The header line that is inserted when no recipients were
specified in (Resent-)To: or (Resent-)Cc: message headers.
.SH "Address transformations"
.ad
.fi
.IP \fBempty_address_recipient\fR
The destination for undeliverable mail from <>. This
substitution is done before all other address rewriting.
.IP \fBcanonical_maps\fR
Address mapping lookup table for sender and recipient addresses
in envelopes and headers.
.IP \fBrecipient_canonical_maps\fR
Address mapping lookup table for envelope and header recipient
addresses.
.IP \fBsender_canonical_maps\fR
Address mapping lookup table for envelope and header sender
addresses.
.IP \fBmasquerade_classes\fR
List of address classes subject to masquerading: zero or
more of \fBenvelope_sender\fR, \fBenvelope_recipient\fR,
\fBheader_sender\fR, \fBheader_recipient\fR.
.IP \fBmasquerade_domains\fR
List of domains that hide their subdomain structure.
.IP \fBmasquerade_exceptions\fR
List of user names that are not subject to address masquerading.
.IP \fBvirtual_alias_maps\fR
Address mapping lookup table for envelope recipient addresses.
.SH "Resource controls"
.ad
.fi
.IP \fBduplicate_filter_limit\fR
Limits the number of envelope recipients that are remembered.
.IP \fBheader_address_token_limit\fR
Limits the number of address tokens used to process a message header.
.IP \fBheader_size_limit\fR
Limits the amount of memory in bytes used to process a message header.
.IP \fBin_flow_delay\fR
Amount of time to pause before accepting a message, when the
message arrival rate exceeds the message delivery rate.
.IP \fBextract_recipient_limit\fR
Limit the amount of recipients extracted from message headers.
.SH SEE ALSO
.na
.nf
canonical(5) canonical address lookup table format
qmgr(8) queue manager daemon
syslogd(8) system logging
trivial-rewrite(8) address rewriting
virtual(5) virtual alias lookup table format
.SH FILES
.na
.nf
/etc/postfix/canonical*, canonical mapping table
/etc/postfix/virtual*, virtual mapping table
.SH LICENSE
.na
.nf
.ad
.fi
The Secure Mailer license must be distributed with this software.
.SH AUTHOR(S)
.na
.nf
Wietse Venema
IBM T.J. Watson Research
P.O. Box 704
Yorktown Heights, NY 10598, USA
