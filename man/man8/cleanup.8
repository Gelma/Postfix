.TH CLEANUP 8 
.ad
.fi
.SH NAME
cleanup
\-
canonicalize and enqueue Postfix message
.SH SYNOPSIS
.na
.nf
\fBcleanup\fR [generic Postfix daemon options]
.SH DESCRIPTION
.ad
.fi
The \fBcleanup\fR daemon processes inbound mail, inserts it
into the \fBincoming\fR mail queue, and informs the queue
manager of its arrival.

The \fBcleanup\fR daemon always performs the following transformations:
.IP \(bu
Insert missing message headers: (\fBResent-\fR) \fBFrom:\fR,
\fBTo:\fR, \fBMessage-Id:\fR, and \fBDate:\fR.
.IP \(bu
Extract envelope recipient addresses from (\fBResent-\fR) \fBTo:\fR,
\fBCc:\fR and \fBBcc:\fR message headers when no recipients are
specified in the message envelope.
.IP \(bu
Transform envelope and header addresses to the standard
\fIuser@fully-qualified-domain\fR form that is expected by other
Postfix programs.
This task is delegated to the \fBtrivial-rewrite\fR(8) daemon.
.IP \(bu
Eliminate duplicate envelope recipient addresses.
.PP
The following address transformations are optional:
.IP \(bu
Optionally, rewrite all envelope and header addresses according
to the mappings specified in the \fBcanonical\fR(5) lookup tables.
.IP \(bu
Optionally, masquerade envelope sender addresses and message
header addresses (i.e. strip host or domain information below
all domains listed in the \fBmasquerade_domains\fR parameter,
except for user names listed in \fBmasquerade_exceptions\fR).
Address masquerading does not affect envelope recipients.
.IP \(bu
Optionally, expand envelope recipients according to information
found in the \fBvirtual\fR(5) lookup tables.
.PP
The \fBcleanup\fR daemon performs sanity checks on the content of
each message. When it finds a problem, by default it returns a
diagnostic status to the client, and leaves it up to the client
to deal with the problem. Alternatively, the client can request
the \fBcleanup\fR daemon to bounce the message back to the sender
in case of trouble.
.SH STANDARDS
.na
.nf
RFC 822 (ARPA Internet Text Messages)
.SH DIAGNOSTICS
.ad
.fi
Problems and transactions are logged to \fBsyslogd\fR(8).
.SH BUGS
.ad
.fi
Table-driven rewriting rules make it hard to express \fBif then
else\fR and other logical relationships.
.SH CONFIGURATION PARAMETERS
.na
.nf
.ad
.fi
The following \fBmain.cf\fR parameters are especially relevant to
this program. See the Postfix \fBmain.cf\fR file for syntax details
and for default values. Use the \fBpostfix reload\fR command after
a configuration change.
.SH Miscellaneous
.ad
.fi
.IP \fBalways_bcc\fR
Address to send a copy of each message that enters the system.
.IP \fBhopcount_limit\fR
Limit the number of \fBReceived:\fR message headers.
.IP \fBrecipients_witheld_header\fR
The header line that is inserted when no recipients were
specified in (Resent-)To: or (Resent-)Cc: message headers.
.SH "Address transformations"
.ad
.fi
.IP \fBempty_address_recipient\fR
The destination for undeliverable mail from <>. This
substitution is done before all other address rewriting.
.IP \fBcanonical_maps\fR
Address mapping lookup table for sender and recipient addresses
in envelopes and headers.
.IP \fBrecipient_canonical_maps\fR
Address mapping lookup table for envelope and header recipient
addresses.
.IP \fBsender_canonical_maps\fR
Address mapping lookup table for envelope and header sender
addresses.
.IP \fBmasquerade_domains\fR
List of domains that hide their subdomain structure.
.IP \fBmasquerade_exceptions\fR
List of user names that are not subject to address masquerading.
.IP \fBvirtual_maps\fR
Address mapping lookup table for envelope recipient addresses.
.SH "Resource controls"
.ad
.fi
.IP \fBduplicate_filter_limit\fR
Limit the number of envelope recipients that are remembered.
.IP \fBheader_size_limit\fR
Limit the amount of memory in bytes used to process a message header.
.SH SEE ALSO
.na
.nf
canonical(5) canonical address lookup table format
qmgr(8) queue manager daemon
syslogd(8) system logging
trivial-rewrite(8) address rewriting
virtual(5) virtual address lookup table format
.SH FILES
.na
.nf
/etc/postfix/canonical*, canonical mapping table
/etc/postfix/virtual*, virtual mapping table
.SH LICENSE
.na
.nf
.ad
.fi
The Secure Mailer license must be distributed with this software.
.SH AUTHOR(S)
.na
.nf
Wietse Venema
IBM T.J. Watson Research
P.O. Box 704
Yorktown Heights, NY 10598, USA
