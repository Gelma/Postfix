> Also, what considerations are there for file locking or other potential
> problems when running Postfix with a Netapp-style box for /var/mail
> delivery?  I know that FreeBSD has broken NFS file locking (both client
> and server?) but I'm not sure if this is something Postfix can work around
> or not.

Postfix jumps several hoops in order to deal with NFS-specific
brain damage, however some operations can fail irrecoverably.  This
is why Wietse makes no promises about Postfix reliability on NFS.

For queue locking, NFS is not an issue because you cannot share
Postfix queues between Postfix instances anyawy.

For mailbox locking, some systems use flock() by default (use:
``postconf mailbox_delivery_lock'' and ``postconf virtual_mailbox_lock''
to find out about your system). flock() does not work over NFS.
This causes loss of mail when multiple hosts access the same
mailboxes.

In order to have mailbox locking over NFS you have to configure
everything to use fcntl() locks for mailbox access (or switch to
maildir style, which needs no application-level lock controls).

To turn on fcntl locks with Postfix you specify:

    virtual_mailbox_lock = fcntl
    mailbox_delivery_lock = fcntl

This is useful only if all mailbox access software uses fcntl()
locks. I have no information on how well fcntl() locks work on NFS.

You can also "play safe" and throw in username.lock files:

    virtual_mailbox_lock = fcntl, dotlock
    mailbox_delivery_lock = fcntl, dotlock

this is the mix that many applications end up using.
