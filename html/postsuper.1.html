<html> <head> </head> <body> <pre>
POSTSUPER(1)                                         POSTSUPER(1)

<b>NAME</b>
       postsuper - Postfix superintendent

<b>SYNOPSIS</b>
       <b>postsuper</b> [<b>-psv</b>] [<b>-c</b> <i>config_dir</i>] [<b>-d</b> <i>queue_id</i>] [<b>-h</b>
       <i>queue_id</i>] [<b>-H</b> <i>queue_id</i>] [<b>-r</b> <i>queue_id</i>] [<i>directory</i> <i>...</i>]

<b>DESCRIPTION</b>
       The <b>postsuper</b> command does maintenance jobs on the Postfix
       queue.  Use of the command is restricted to the superuser.

       By default, <b>postsuper</b> performs  the  operations  requested
       with  the  <b>-s</b>  and  <b>-p</b> command-line options on all Postfix
       queue directories - this includes the <b>incoming</b>, <b>active</b> and
       <b>deferred</b> directories with mail files and the <b>bounce</b>, <b>defer</b>
       and <b>flush</b> directories with log files.

       Options:

       <b>-c</b> <i>config_dir</i>
              The <b>main.cf</b> configuration  file  is  in  the  named
              directory  instead  of  the  default  configuration
              directory. See  also  the  MAIL_CONFIG  environment
              setting below.

       <b>-d</b> <i>queue_id</i>
              Delete one message with the named queue ID from the
              named  mail  queue(s)  (default:  <b>hold</b>,   <b>incoming</b>,
              <b>active</b> and <b>deferred</b>).  If a <i>queue_id</i> of <b>-</b> is speci-
              fied, the program reads  queue  IDs  from  standard
              input.  For  example, to delete all mail from or to
              <b>user@example.com</b>:

              mailq | tail +2 | awk  'BEGIN { RS = "" } \
                  / user@example\.com$/ { print $1 } \
              ' | tr -d '*!' | postsuper -d -

              Specify <b>-d</b> <b>ALL</b> to remove all messages; for example,
              specify  <b>-d</b>  <b>ALL</b>  <b>deferred</b>  to  delete  mail in the
              <b>deferred</b> queue.  As a safety measure, the word  <b>ALL</b>
              must be specified in upper case.

              <b>Postfix</b>  <b>queue</b>  <b>IDs</b>  <b>are</b>  <b>reused.</b>   <b>There</b> <b>is</b> <b>a</b> <b>very</b>
              <b>small</b> <b>possibility</b> <b>that</b> <b>postsuper</b> <b>deletes</b> <b>the</b>  <b>wrong</b>
              <b>message</b>  <b>file</b> <b>when</b> <b>it</b> <b>is</b> <b>executed</b> <b>while</b> <b>the</b> <b>Postfix</b>
              <b>mail</b> <b>system</b> <b>is</b> <b>running.</b>

              The scenario is as follows:

              1)     The Postfix queue manager deletes  the  mes-
                     sage  that  <b>postsuper</b> is supposed to delete,
                     because Postfix is finished  with  the  mes-
                     sage.

              2)     New  mail  arrives,  and  the new message is
                     given the same queue ID as the message  that
                     <b>postsuper</b> is supposed to delete.  The proba-
                     bility for reusing a  deleted  queue  ID  is
                     about  1  in  2**15 (the number of different
                     microsecond values that the system clock can
                     distinguish within a second).

              3)     <b>postsuper</b>  deletes  the new message, instead
                     of the  old  message  that  it  should  have
                     deleted.

       <b>-h</b> <i>queue_id</i>
              Put  mail  "on  hold" so that no attempt is made to
              deliver it.  Move one message with the named  queue
              ID from the named mail queue(s) (default: <b>incoming</b>,
              <b>active</b> and <b>deferred</b>)  to  the  <b>hold</b>  queue.   If  a
              <i>queue_id</i> of <b>-</b> is specified, the program reads queue
              IDs from standard input.

              Specify <b>-h</b> <b>ALL</b> to hold all messages;  for  example,
              specify  <b>-h</b>  <b>ALL</b>  <b>deferred</b>  to  hold  mail  in  the
              <b>deferred</b> queue.  As a safety measure, the word  <b>ALL</b>
              must be specified in upper case.

              Note:  mail  that  is put "on hold" will not expire
              when its  time  in  the  queue  exceeds  the  <b>maxi-</b>
              <b>mal</b><i>_</i><b>queue</b><i>_</i><b>lifetime</b> setting.

       <b>-H</b> <i>queue_id</i>
              Release mail that was put "on hold".  Move one mes-
              sage with the named queue ID from  the  named  mail
              queue(s) (default: <b>hold</b>) to the <b>deferred</b> queue.  If
              a <i>queue_id</i> of <b>-</b> is  specified,  the  program  reads
              queue IDs from standard input.

              Specify  <b>-H</b>  <b>ALL</b>  to  release  all mail that is "on
              hold".  As a safety measure, the word <b>ALL</b>  must  be
              specified in upper case.

       <b>-p</b>     Purge  old temporary files that are left over after
              system or software crashes.

       <b>-r</b> <i>queue_id</i>
              Requeue the message with the named  queue  ID  from
              the  named  mail queue(s) (default: <b>hold</b>, <b>incoming</b>,
              <b>active</b> and <b>deferred</b>).   To  requeue  multiple  mes-
              sages,  specify  multiple  <b>-r</b> command-line options.
              Alternatively, if a <i>queue_id</i> of <b>-</b> is specified, the
              program reads queue IDs from standard input.

              Specify <b>-r</b> <b>ALL</b> to requeue all messages. As a safety
              measure, the word <b>ALL</b> must be  specified  in  upper
              case.

              A  requeued message is moved to the <b>maildrop</b> queue,
              from where it is copied by the pickup daemon  to  a
              new  file whose name is guaranteed to match the new
              queue file inode number. The new queue file is sub-
              jected  again to mail address rewriting and substi-
              tution. This is useful when rewriting rules or vir-
              tual mappings have changed.

              Postfix  queue  IDs  are  reused.   There is a very
              small possibility that <b>postsuper</b> requeues the wrong
              message  file when it is executed while the Postfix
              mail system is running, but no harm should be done.

       <b>-s</b>     Structure check and structure repair.  It is highly
              recommended to perform this operation  once  before
              Postfix startup.

              <b>o</b>      Rename  files  whose name does not match the
                     message file inode number. This operation is
                     necessary  after restoring a mail queue from
                     a different machine, or from backup media.

              <b>o</b>      Move queue files that are in the wrong place
                     in the file system hierarchy and remove sub-
                     directories that are no longer needed.  File
                     position  rearrangements are necessary after
                     a  change  in  the  <b>hash</b><i>_</i><b>queue</b><i>_</i><b>names</b>  and/or
                     <b>hash</b><i>_</i><b>queue</b><i>_</i><b>depth</b> configuration parameters.

       <b>-v</b>     Enable verbose logging for debugging purposes. Mul-
              tiple <b>-v</b> options  make  the  software  increasingly
              verbose.

<b>DIAGNOSTICS</b>
       Problems  are reported to the standard error stream and to
       <b>syslogd</b>.

       <b>postsuper</b> reports the number of messages deleted with  <b>-d</b>,
       the number of messages requeued with <b>-r</b>, and the number of
       messages whose queue file name  was  fixed  with  <b>-s</b>.  The
       report is written to the standard error stream and to <b>sys-</b>
       <b>logd</b>.

<b>ENVIRONMENT</b>
       MAIL_CONFIG
              Directory with the <b>main.cf</b> file.

<b>BUGS</b>
       Mail that is not sanitized by Postfix (i.e.  mail  in  the
       <b>maildrop</b> queue) cannot be placed "on hold".

<b>CONFIGURATION</b> <b>PARAMETERS</b>
       See  the  Postfix  <b>main.cf</b> file for syntax details and for
       default values.

       <b>hash</b><i>_</i><b>queue</b><i>_</i><b>depth</b>
              Number of subdirectory levels for hashed queues.

       <b>hash</b><i>_</i><b>queue</b><i>_</i><b>names</b>
              The names of queues that are organized into  multi-
              ple levels of subdirectories.

<b>LICENSE</b>
       The  Secure  Mailer  license must be distributed with this
       software.

<b>AUTHOR(S)</b>
       Wietse Venema
       IBM T.J. Watson Research
       P.O. Box 704
       Yorktown Heights, NY 10598, USA

                                                     POSTSUPER(1)
</pre> </body> </html>
